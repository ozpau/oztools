# nbd


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
path = Path("../..")
Path.BASE_PATH = path
```

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L40"
target="_blank" style="float:right; font-size:smaller">source</a>

### make_things_pretty

>  make_things_pretty ()

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L53"
target="_blank" style="float:right; font-size:smaller">source</a>

### nbd_new_fn

>  nbd_new_fn (name:str, description:str, license:str='Apache-2.0',
>                  private:bool=False)

*Create a new nbdev project and setup github repo for it*

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L81"
target="_blank" style="float:right; font-size:smaller">source</a>

### nbd_new

>  nbd_new (name:str, description:str, license:str='Apache-2.0',
>               private:bool=False)

*Create a new nbdev project and setup github repo for it*

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L86"
target="_blank" style="float:right; font-size:smaller">source</a>

### new_notebook_template

>  new_notebook_template (name, description)

FIXME: Cell below results in an error for some reason

``` python
template = new_notebook_template("foo", "Makes foo using bar")
print('\n---\n\n'.join(L(template['cells']).attrgot('source').map(''.join)))
```

    # foo

    > Makes foo using bar
    ---

    #| default_exp foo
    ---

    #| hide
    from nbdev.showdoc import *
    ---

    #| export
    from fastcore.all import *
    ---

    #| hide
    import nbdev; nbdev.nbdev_export()

``` python
m = re.match(r'(\d+).*\.ipynb', '99ab_asd.ipynb')
m.group(1)
```

    '99'

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L117"
target="_blank" style="float:right; font-size:smaller">source</a>

### zero_pad

>  zero_pad (num)

``` python
test_eq(zero_pad(9), '09')
test_eq(zero_pad(32), '32')
```

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L123"
target="_blank" style="float:right; font-size:smaller">source</a>

### nbd_add

>  nbd_add (name:str, description:str, at:Optional[int]=None)

*Add new notebook to the project*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>str</td>
<td></td>
<td></td>
</tr>
<tr>
<td>description</td>
<td>str</td>
<td></td>
<td></td>
</tr>
<tr>
<td>at</td>
<td>Optional</td>
<td>None</td>
<td>If specified, insert new notebook at a specific position</td>
</tr>
</tbody>
</table>

## nbd_watch

Adapted from
https://github.com/ProCern/asyncinotify/blob/master/examples/recursivewatch.py

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L140"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_directories_recursive

>  get_directories_recursive (path:pathlib.Path)

``` python
list(get_directories_recursive(Path('.')))
```

    [Path('.'),
     Path('.ipynb_checkpoints'),
     Path('02_nbd'),
     Path('02_nbd/favicons'),
     Path('02_nbd/favicons/arlantr'),
     Path('02_nbd/favicons/food-ocal'),
     Path('02_nbd/favicons/food-ocal/vegetable'),
     Path('02_nbd/favicons/food-ocal/treat'),
     Path('02_nbd/favicons/food-ocal/pasta'),
     Path('02_nbd/favicons/food-ocal/fruit'),
     Path('02_nbd/favicons/food-ocal/drink'),
     Path('02_nbd/favicons/food-ocal/dairy'),
     Path('02_nbd/favicons/food-ocal/meat')]

Algorithm: 1. Watch forever until an event happens. 2. After that, watch
for 1s. If no more events fire, yield an event. Go back to step 1. 3. If
more events fire in that 1s, record those events and go back to step 2.

Extra features: 1. If new directories are added, mark them for watching.
2. Skip events we are not interested in

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L144"
target="_blank" style="float:right; font-size:smaller">source</a>

### watch_new_directories

>  watch_new_directories (inotify, event)

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L149"
target="_blank" style="float:right; font-size:smaller">source</a>

### extract_exports

>  extract_exports (file)

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L156"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_hash

>  get_hash (s)

``` python
get_hash("hello, world!")
```

    b'h\xe6V\xb2Q\xe6~\x83X\xbe\xf8H:\xb0\xd5\x1cf\x19\xf3\xe7\xa1\xa9\xf0\xe7X8\xd4\x1f\xf3h\xf7('

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L161"
target="_blank" style="float:right; font-size:smaller">source</a>

### setup_tracking

>  setup_tracking (path)

``` python
tracked_files = setup_tracking(Path('.'))
```

``` python
list(get_directories_recursive(Path('.')))[1].name
```

    '.ipynb_checkpoints'

``` python
tracked_files.keys()
```

    dict_keys([Path('00_core.ipynb'), Path('01_gh.ipynb'), Path('03_kgl.ipynb'), Path('02_nbd.ipynb'), Path('04_format.ipynb')])

``` python
s = "hello"
```

``` python
s.encode("utf-8")
```

    b'hello'

``` python
re.match(r'^(?!\.\~).+\.ipynb$', '.~00_core.ipynb')
```

``` python
f = list(get_directories_recursive(Path('.')))[0].ls()[0]
```

``` python
print('\n'.join([''.join(x['source']) for x in f.read_json()['cells'] if x['cell_type'] == 'code' and 'export' in ''.join(x['source'])]))
```

    #| export
    from fastcore.all import *
    #| export
    def pad(s: str, pad_to: int):
        "Pad `s` with spaces to the right"
        return s + " " * max(0, (pad_to - len(s)))
    #| export
    def attrkey(attr):
        "Create a function that fetches `attr` of its input"
        return lambda x: getattr(x, attr)
    #| export
    def str_enumerate(lst: list,
                      start: int = 0 # enumerate from what number
                     ) -> Iterable[str]:
        "Create aligned sequence of numbered strings for strings in `lst`"
        return map(lambda x: f"  {pad(str(x[0]),2)}  {x[1]}", enumerate(lst, start))
    #| export
    def cz(*funcs):
        "Compose functions together"
        def fn(x):
            for fn in funcs:
                x = fn(x)
            return x
        return fn
    #| hide
    import nbdev; nbdev.nbdev_export()

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L200"
target="_blank" style="float:right; font-size:smaller">source</a>

### inotify_watch

>  inotify_watch (path, debounce_interval=0.5)

``` python
s = '.~04_core.ipynb'
s.startswith('.~')
```

    True

``` python
Path('/user/home/.~04_core.ipynb').name
```

    '.~04_core.ipynb'

Right now, it seems the best way to figure out when user actually saves
is to count number of events: - Saving file manually results in at least
13 events, while autosave only produces 9 events (sometimes 10).

``` python
k = re.match(r'\.\~(.*.ipynb)', '.~04_core.ipynb')
k.group(1)
```

    '04_core.ipynb'

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L205"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_files_updated

>  get_files_updated (events)

``` python
p = Path('nbs/api/02_nbd.ipynb')
p.parent
```

    Path('nbs/api')

``` python
p.relative_to(Path('nbs')).as_posix()
```

    'api/02_nbd.ipynb'

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L212"
target="_blank" style="float:right; font-size:smaller">source</a>

### anything_updated

>  anything_updated (tracked_files, events)

------------------------------------------------------------------------

<a
href="https://github.com/ozellpaukert/oztools/blob/main/oztools/nbd.py#L222"
target="_blank" style="float:right; font-size:smaller">source</a>

### nbd_watch

>  nbd_watch ()

*Watch `nbs` folder and automatically run `nbdev_export` on file change*
